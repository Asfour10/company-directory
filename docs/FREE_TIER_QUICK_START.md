# Free Tier Quick Start (5 Minutes)

## TL;DR - Deploy for Free in 5 Steps

### 1. Run Setup Script (1 minute)
```bash
# Linux/Mac
chmod +x scripts/setup-free-tier.sh
./scripts/setup-free-tier.sh

# Windows
.\scripts\setup-free-tier.ps1
```

This generates all your secrets and creates configuration files.

### 2. Sign Up for Free Services (2 minutes)
- **Neon.tech** - Free PostgreSQL â†’ Get connection string
- **Upstash.com** - Free Redis â†’ Get connection string  
- **Render.com** - Free hosting â†’ Connect GitHub repo

### 3. Deploy to Render (1 minute)
1. Push code to GitHub
2. Go to [render.com](https://render.com)
3. Click "New" â†’ "Blueprint"
4. Connect your repository
5. Render auto-detects `render.yaml`

### 4. Add Environment Variables (30 seconds)
In Render dashboard, add these to backend service:
```
DATABASE_URL=<paste-from-neon>
REDIS_URL=<paste-from-upstash>
```
(Other secrets are auto-generated by Render)

### 5. Run Migrations (30 seconds)
In Render backend shell:
```bash
npm run prisma:migrate deploy
```

**Done!** Your app is live at:
- Frontend: `https://company-directory-frontend.onrender.com`
- Backend: `https://company-directory-backend.onrender.com`

---

## Detailed Steps

### Step 1: Get Free Database (Neon.tech)

1. Go to [neon.tech](https://neon.tech)
2. Sign up with GitHub (no credit card)
3. Create project: `company-directory`
4. Copy connection string:
   ```
   postgresql://user:pass@ep-xxx.us-east-2.aws.neon.tech/neondb?sslmode=require
   ```
5. In Neon SQL Editor, run:
   ```sql
   CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
   CREATE EXTENSION IF NOT EXISTS "pg_trgm";
   ```

**Free Tier:** 0.5GB storage, automatic backups

---

### Step 2: Get Free Redis (Upstash)

1. Go to [upstash.com](https://upstash.com)
2. Sign up with GitHub (no credit card)
3. Create database: `company-directory-cache`
4. Copy connection string:
   ```
   redis://default:pass@region.upstash.io:6379
   ```

**Free Tier:** 10,000 commands/day, 256MB storage

---

### Step 3: Get Free Storage (Optional - Cloudflare R2)

1. Go to [cloudflare.com](https://cloudflare.com)
2. Sign up (credit card required but won't charge)
3. Go to R2 â†’ Create bucket: `company-directory-files`
4. Create API token â†’ Save keys

**Free Tier:** 10GB storage, no egress fees

---

### Step 4: Deploy to Render

#### Option A: One-Click Deploy (Easiest)

1. Push code to GitHub:
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git remote add origin https://github.com/yourusername/company-directory.git
   git push -u origin main
   ```

2. Click this button:
   [![Deploy to Render](https://render.com/images/deploy-to-render-button.svg)](https://render.com/deploy)

3. Or manually:
   - Go to [render.com](https://render.com)
   - New â†’ Blueprint
   - Connect GitHub repo
   - Render uses `render.yaml`

#### Option B: Manual Deploy

**Backend:**
1. New â†’ Web Service
2. Connect GitHub repo
3. Name: `company-directory-backend`
4. Build: `cd backend && npm install && npm run build`
5. Start: `cd backend && npm start`
6. Add environment variables (see below)

**Frontend:**
1. New â†’ Static Site
2. Connect GitHub repo
3. Name: `company-directory-frontend`
4. Build: `cd frontend && npm install && npm run build`
5. Publish: `frontend/dist`

---

### Step 5: Configure Environment Variables

In Render backend service settings, add:

```bash
# Required (from your services)
DATABASE_URL=postgresql://user:pass@host.neon.tech/neondb?sslmode=require
REDIS_URL=redis://default:pass@region.upstash.io:6379

# Auto-generated by Render (or copy from .secrets.txt)
JWT_SECRET=<auto-generated>
ENCRYPTION_KEY=<auto-generated>
SESSION_SECRET=<auto-generated>

# URLs (update with your actual Render URLs)
FRONTEND_URL=https://company-directory-frontend.onrender.com
API_URL=https://company-directory-backend.onrender.com
CORS_ORIGINS=https://company-directory-frontend.onrender.com

# Optional: Cloudflare R2 (if using)
AWS_ACCESS_KEY_ID=<your-r2-key>
AWS_SECRET_ACCESS_KEY=<your-r2-secret>
S3_BUCKET_NAME=company-directory-files
S3_ENDPOINT=https://account-id.r2.cloudflarestorage.com
AWS_REGION=auto
```

---

### Step 6: Initialize Database

1. Go to Render dashboard
2. Open backend service
3. Click "Shell" tab
4. Run migrations:
   ```bash
   npm run prisma:migrate deploy
   ```

5. Create admin user:
   ```bash
   # Create seed script if not exists
   cat > prisma/seed-simple.ts << 'EOF'
   import { PrismaClient } from '@prisma/client';
   const prisma = new PrismaClient();
   
   async function main() {
     const tenant = await prisma.tenant.create({
       data: { name: 'My Company', subdomain: 'app', is_active: true }
     });
     
     const admin = await prisma.user.create({
       data: {
         email: 'admin@company.com',
         password_hash: '$2b$10$...',  // Change this!
         role: 'super_admin',
         tenant_id: tenant.id,
         is_active: true
       }
     });
     
     console.log('Created:', { tenant, admin });
   }
   
   main().finally(() => prisma.$disconnect());
   EOF
   
   # Run seed
   npx ts-node prisma/seed-simple.ts
   ```

---

### Step 7: Test Your App

1. **Open frontend:**
   ```
   https://company-directory-frontend.onrender.com
   ```

2. **Check backend health:**
   ```bash
   curl https://company-directory-backend.onrender.com/health
   ```

3. **Login:**
   - Email: `admin@company.com`
   - Password: (from `.secrets.txt`)

---

## Troubleshooting

### App is slow to load
**Cause:** Free tier services sleep after 15 min inactivity

**Solutions:**
1. Use [UptimeRobot](https://uptimerobot.com) (free) to ping every 5 min
2. Accept 30-second wake-up time
3. Upgrade to paid tier ($7/month for always-on)

### Database connection error
**Check:**
```bash
# Test connection
psql "postgresql://user:pass@host.neon.tech/neondb?sslmode=require" -c "SELECT 1;"

# Verify in Render shell
echo $DATABASE_URL
```

### Redis connection error
**Check:**
```bash
# Test connection
redis-cli -u redis://default:pass@region.upstash.io:6379 ping

# Verify in Render shell
echo $REDIS_URL
```

### Build fails
**Common issues:**
1. Missing `package-lock.json` - Run `npm install` locally first
2. TypeScript errors - Run `npm run build` locally to check
3. Missing environment variables - Check Render dashboard

---

## Cost Breakdown

### Completely Free Setup
```
Neon PostgreSQL:     $0/month (0.5GB)
Upstash Redis:       $0/month (10k commands/day)
Render Backend:      $0/month (750 hours)
Render Frontend:     $0/month (100GB bandwidth)
Cloudflare R2:       $0/month (10GB storage)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total:               $0/month
```

**Limitations:**
- Services sleep after 15 min inactivity
- 0.5GB database storage
- 10k Redis commands per day
- Shared resources (slower)

**Good for:**
- Testing and demos
- Personal projects
- Small teams (<50 users)
- Low traffic sites

---

## Upgrade Path

### When to Upgrade

**Upgrade Database ($19/month)** when:
- Approaching 0.5GB storage limit
- Need better performance
- Want more backups

**Upgrade Hosting ($7/month)** when:
- Can't accept sleep time
- Need faster response times
- Have consistent traffic

**Upgrade Redis ($5/month)** when:
- Exceeding 10k commands/day
- Need more memory
- Want persistence

### Recommended Upgrade Order
1. **First:** Hosting ($7/month) - Eliminates sleep time
2. **Second:** Database ($19/month) - More storage and performance
3. **Third:** Redis ($5/month) - Only if hitting limits

---

## Monitoring Free Tier Usage

### Neon Dashboard
- Check storage usage
- Monitor query performance
- View connection count

### Upstash Dashboard
- Check daily command count
- Monitor memory usage
- View connection stats

### Render Dashboard
- Check bandwidth usage
- Monitor build minutes
- View service logs

---

## Tips for Staying Free

1. **Optimize Database:**
   - Add indexes for common queries
   - Clean up old audit logs monthly
   - Use connection pooling

2. **Reduce Redis Usage:**
   - Increase cache TTLs
   - Cache only frequently accessed data
   - Monitor command count

3. **Keep Services Warm:**
   - Use UptimeRobot to ping every 5 min
   - Or accept 30-second wake time

4. **Optimize Images:**
   - Compress before upload
   - Limit file sizes to 2MB
   - Use WebP format

---

## Next Steps

After deployment:

1. **Change admin password** (important!)
2. **Set up custom domain** (optional, $12/year)
3. **Configure monitoring** (UptimeRobot free)
4. **Add more users** and test
5. **Monitor usage** and upgrade as needed

---

## Support

**Documentation:**
- Full guide: `docs/FREE_TIER_DEPLOYMENT.md`
- Production guide: `docs/PRODUCTION_SETUP_GUIDE.md`

**Community:**
- Render: https://community.render.com
- Neon: https://discord.gg/neon
- Upstash: https://discord.gg/upstash

**Issues:**
- Check logs in Render dashboard
- Test connections with provided commands
- Review troubleshooting section above

---

**Estimated Setup Time:** 5-10 minutes
**Cost:** $0/month
**Difficulty:** Easy

Good luck with your deployment! ðŸš€
